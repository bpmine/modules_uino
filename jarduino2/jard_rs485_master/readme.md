# Maître des OYAsLe maître des OYAs permet de commander une pompe et plusieurs électrovannes pour remplir des OYAs.## OyasLes OYAs sont des sortes de pot en argile enterrés utilisés depuis des millénaires pour distribuer de l'eau à des cultures.On remplit régulièrement ces pots. Grâce à leur porosité, l'eau se diffuse à travers l'OYAs au fur et à mesure où les racines des plantes assèchent la terre à proximité.- Ils évitent les pertes d'eau par évaporation- ne mouillent pas les feuilles des plantes- ne mouille pas le sol en surface- évitent le stress hydrique- permettent de faire des économies d'eau(images/un_oya.png "Un OYA")## Description du système de remplissage automatiqueLe but du système de remplissage automatique des OYAs est de pouvoir s'absenter pendant les vacances tout en laissant les OYAs se gérer tous seuls.### Principe de fonctionnementDes cuves récupèrent l'eau de pluie. A partir de ces cuves, un système comportant une pompe et plusieurs électrovannes permet de remplir les OYAs.Le système rempli chaque OYA jusqu'au maximum ou bien selon le programme souhaité. La stratégie de remplissage est entièrement programmable.### CuvesNous avons 4 cuves pour une capacité totale d'environ 1600 L.- Cuve principale de 1000 L- cuve  "Paul" de 100 L (pour gouteurs petits bacs)- cuve "Réduit" de 250 L pour les OYAs- cuve "Barbec" de 250 L pour les OYAsDeux cuves de 250 L alimentent donc nos deux systèmes de remplissage automatique.Les cuves sont communicantes et un système permet de pomper l'eau de la cuve principale vers les autres. Ce système est décrit ici: [Modules Wifi IO](..\jard_wemos)Des modules Wifi permettent donc de piloter le remplissage des cuves.### Réseau/Tuyau(images/reseau.png "Réseau RS485 et tuyau")Chaque système OYAs est composé d'un module maître et de plusieurs modules esclaves reliés entre eux par un réseau RS485 et un tuyau 12mm.Le câble réseau comporte une alimentation 12V et les fils A et B du RS485.(images/connecteur.png "Connecteur étanche")Le réseau possède deux résistances de terminaison de 120 Ohms aux deux extrémités. Il est également polarisé côté maître par une pull up et une pull down de 220 Ohms (Valeur encore susceptible de bouger).Pour trouver les bonnes valeurs et étant donné la mauvaise qualité de câble utilisé, il faut effectuer des mesures de signal au bout du bus et vérifier que les tensions au repos de A et de B sont conformes à la norme RS485. (images/bouchon.png "Bouchon")__NB:__ Le dispositif de la photo ci-dessus contient une résistance de 128 Ohm. On appelle ça un "bouchon" !! (d'où le bouchon de liège...)## Modules électronique de pilotage### Module PompeLe module pompe contient une carte esclave RS485.Connecteurs:- connecteur 4 voies bus RS485 + alim- connecteur pompe- connecteur débitmètreCe module est placé en sortie de cuve pour pomper l'eau et donner une certaine pression dans le tuyau. La pompe est nécessaire pour assurer un débit constant quelque soit le niveau d'eau dans la cuve et quelle que soit la hauteur relative entre la cuve et les différents OYAs.Il faut aussi noter qu'une pression minimale est nécessaire pour ouvrir une électrovanne (voir ces caractéristiques).### Module Oya### Module Maître## Protocole réseau (RS485)### PrincipeLe réseau est de type RS485. Il comporte un maître et plusieurs esclaves. Chaque esclave a une adresse unique (de 1 à 14 ou 1 à E en hexadécimal).Seul le maître peut initier une communication. Un seul esclave peut répondre à une trame émise par le maître.Types de messages du maître:- Trame Commandes- Trame Ping- Trame SyncTypes de réponses d'un esclave:- Trame Pompe- Trame Oya- Trame PongLa communication se fait par cycles. Chaque cycle se termine par une trame Sync.Durant un cycle, le maître envoie autant de trames __*"Commandes"*__ qu'il y'a d'esclaves configurés. Chaque trame __*"Commandes"*__ comporte un appel destiné à un esclave en particulier. Seul l'esclave appelé peut répondre avec l'une des deux trames __*"Oya"*__ ou __*"Pompe"*__.Après un __*"Sync"*__, le maître doit impérativement attendre un temps minimum avant d'initier un nouveau cycle. Cela permet aux esclaves d'effectuer des traitements.#### Echange Commandes##### Trame Commandes##### Trame Pompe##### Trame Oya#### Echange Ping/Pong#### Timing notableTemps de cycleTemps entre le sync et un nouveau cycle